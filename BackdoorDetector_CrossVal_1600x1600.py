{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"mount_file_id":"18cE5JVjaC_lWc3chi4fB_RVe-fV3mMxT","authorship_tag":"ABX9TyNyZODPX4q4Y1v1P72cO/Tu"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"4196cf66b0f247418aa8cf9751656a37":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_7bb3fc99c73f4787b25cc569551d6ab3","IPY_MODEL_5871e2493eeb4b528863d611ac118462","IPY_MODEL_0c954cd5e00f4aa0a7afdfd22daf5408"],"layout":"IPY_MODEL_2e79e7d5867d4acf8478bb77524b1fbe"}},"7bb3fc99c73f4787b25cc569551d6ab3":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6a8eb75b70d945be87502ef96569cfb3","placeholder":"​","style":"IPY_MODEL_9651f5c925d04b7aa82729929a397016","value":"100%"}},"5871e2493eeb4b528863d611ac118462":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_2a56c1e4a2dd45a6a546a9a9a04ec448","max":2313,"min":0,"orientation":"horizontal","style":"IPY_MODEL_d3e3d437dbe947e9b77399a4e6b92ae3","value":2313}},"0c954cd5e00f4aa0a7afdfd22daf5408":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_10ebca404bfc4109945a0c1a13093ec5","placeholder":"​","style":"IPY_MODEL_40be49715dc7430e8e4081b33c0ff162","value":" 2313/2313 [00:00&lt;00:00, 2793.77it/s]"}},"2e79e7d5867d4acf8478bb77524b1fbe":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6a8eb75b70d945be87502ef96569cfb3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9651f5c925d04b7aa82729929a397016":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2a56c1e4a2dd45a6a546a9a9a04ec448":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d3e3d437dbe947e9b77399a4e6b92ae3":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"10ebca404bfc4109945a0c1a13093ec5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"40be49715dc7430e8e4081b33c0ff162":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a4948f13f6d74c82973337a44a388bbf":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_276376bf1b8841b2b24dc1c5206faaa9","IPY_MODEL_1da5a5545de94c819214019ecb94654c","IPY_MODEL_2ddb067053b544e39ca1787da298fee5"],"layout":"IPY_MODEL_a93c59b83a394f9d9a2f4c49a6788464"}},"276376bf1b8841b2b24dc1c5206faaa9":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_03e0ab77ea3f4b8b926184bc372e04fb","placeholder":"​","style":"IPY_MODEL_d453eb582d64405490aeaf3918d0b157","value":""}},"1da5a5545de94c819214019ecb94654c":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_daa56241c25f44f8aa96e3aa7daa019e","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_e856ecee70894f2592666b032400d3a9","value":1}},"2ddb067053b544e39ca1787da298fee5":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_4af5d05efaaa4b96856561591457d6e3","placeholder":"​","style":"IPY_MODEL_2a2a07c0a89a43f2a5affc5d54a3e644","value":" 2313/? [00:36&lt;00:00, 51.85it/s]"}},"a93c59b83a394f9d9a2f4c49a6788464":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"03e0ab77ea3f4b8b926184bc372e04fb":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d453eb582d64405490aeaf3918d0b157":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"daa56241c25f44f8aa96e3aa7daa019e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"e856ecee70894f2592666b032400d3a9":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"4af5d05efaaa4b96856561591457d6e3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2a2a07c0a89a43f2a5affc5d54a3e644":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["4196cf66b0f247418aa8cf9751656a37","7bb3fc99c73f4787b25cc569551d6ab3","5871e2493eeb4b528863d611ac118462","0c954cd5e00f4aa0a7afdfd22daf5408","2e79e7d5867d4acf8478bb77524b1fbe","6a8eb75b70d945be87502ef96569cfb3","9651f5c925d04b7aa82729929a397016","2a56c1e4a2dd45a6a546a9a9a04ec448","d3e3d437dbe947e9b77399a4e6b92ae3","10ebca404bfc4109945a0c1a13093ec5","40be49715dc7430e8e4081b33c0ff162","a4948f13f6d74c82973337a44a388bbf","276376bf1b8841b2b24dc1c5206faaa9","1da5a5545de94c819214019ecb94654c","2ddb067053b544e39ca1787da298fee5","a93c59b83a394f9d9a2f4c49a6788464","03e0ab77ea3f4b8b926184bc372e04fb","d453eb582d64405490aeaf3918d0b157","daa56241c25f44f8aa96e3aa7daa019e","e856ecee70894f2592666b032400d3a9","4af5d05efaaa4b96856561591457d6e3","2a2a07c0a89a43f2a5affc5d54a3e644"]},"id":"XljiXf6Hm50s","executionInfo":{"status":"ok","timestamp":1675586062215,"user_tz":-540,"elapsed":1403005,"user":{"displayName":"清水嶺","userId":"11678528705416048401"}},"outputId":"0e57b356-531a-4c9e-cb3c-2c7da994fa9f"},"outputs":[{"output_type":"stream","name":"stdout","text":["(2313, 1600)\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/2313 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"4196cf66b0f247418aa8cf9751656a37"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["creating word2vec model ...\n"]},{"output_type":"stream","name":"stderr","text":["WARNING:gensim.models.base_any2vec:Effective 'alpha' higher than previous training cycles\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n","2313\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"a4948f13f6d74c82973337a44a388bbf"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["            X1        X2        X3        X4        X5        X6        X7  \\\n","0    -0.431006 -0.364231 -0.125635  0.001507  0.732632  0.219551 -0.207431   \n","1    -0.452722 -0.385856 -0.091132  0.050360  0.896592  0.221478 -0.298491   \n","2    -0.501509 -0.353179 -0.033291  0.090287  0.789738  0.128880 -0.252559   \n","3    -0.503574 -0.353403 -0.030913  0.089687  0.790061  0.128635 -0.252182   \n","4    -0.439771 -0.349310  0.018675  0.088884  0.726302  0.133345 -0.257676   \n","...        ...       ...       ...       ...       ...       ...       ...   \n","2308 -0.462903 -0.370888 -0.143036  0.066571  0.693801  0.116573 -0.213826   \n","2309 -0.399685 -0.387356 -0.120273  0.019979  0.705063  0.177522 -0.197282   \n","2310 -0.497235 -0.323005  0.013293  0.073145  0.712370  0.112322 -0.233943   \n","2311 -0.440954 -0.396797 -0.157425  0.042642  0.684332  0.097696 -0.188615   \n","2312 -0.348540 -0.361904  0.033229  0.146425  0.482439  0.094814 -0.216296   \n","\n","            X8        X9       X10  ...  tfidf_X1590  tfidf_X1591  \\\n","0    -0.147386  0.007867 -0.102386  ...     0.091975     0.035707   \n","1    -0.163165 -0.043788 -0.147574  ...     0.103437     0.030182   \n","2    -0.223686 -0.032575 -0.058026  ...     0.127563     0.059981   \n","3    -0.221734 -0.031934 -0.060180  ...     0.124754     0.060474   \n","4    -0.230795 -0.010583 -0.055870  ...     0.107082     0.043979   \n","...        ...       ...       ...  ...          ...          ...   \n","2308 -0.171873 -0.002748 -0.058841  ...     0.106705     0.027563   \n","2309 -0.169453 -0.001934 -0.128414  ...     0.099688     0.048355   \n","2310 -0.218614 -0.010395 -0.021395  ...     0.129491     0.025792   \n","2311 -0.164939 -0.000769 -0.081717  ...     0.098826     0.035952   \n","2312 -0.170553 -0.007361 -0.127189  ...     0.001284     0.000000   \n","\n","      tfidf_X1592  tfidf_X1593  tfidf_X1594  tfidf_X1595  tfidf_X1596  \\\n","0        0.018588     0.018025     0.011073     0.009045     0.003503   \n","1        0.008646     0.000000     0.000000     0.000000     0.000000   \n","2        0.005118     0.000000     0.002375     0.000000     0.000000   \n","3        0.005160     0.000000     0.002394     0.000000     0.000000   \n","4        0.002261     0.000000     0.000000     0.000000     0.000000   \n","...           ...          ...          ...          ...          ...   \n","2308     0.014914     0.017628     0.008140     0.008644     0.009373   \n","2309     0.030300     0.053503     0.018744     0.016586     0.012332   \n","2310     0.006465     0.001074     0.000000     0.000000     0.000000   \n","2311     0.024030     0.030178     0.005574     0.000000     0.000000   \n","2312     0.000000     0.000000     0.000000     0.000000     0.000000   \n","\n","      tfidf_X1597  tfidf_X1598  tfidf_X1599  \n","0        0.007097     0.004947     0.000000  \n","1        0.000000     0.005825     0.000000  \n","2        0.000000     0.000000     0.000000  \n","3        0.000000     0.000000     0.000000  \n","4        0.000000     0.000000     0.000000  \n","...           ...          ...          ...  \n","2308     0.001696     0.011820     0.000000  \n","2309     0.007809     0.000000     0.000000  \n","2310     0.000000     0.000000     0.000000  \n","2311     0.000000     0.000000     0.000000  \n","2312     0.000000     0.020821     0.017263  \n","\n","[2313 rows x 3200 columns]\n","      label_id\n","0            0\n","1            0\n","2            0\n","3            0\n","4            0\n","...        ...\n","2308         1\n","2309         1\n","2310         1\n","2311         1\n","2312         1\n","\n","[2313 rows x 1 columns]\n","Fitting XGboost model ...\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["accuracy: 0.9770843267603526\n","precision: 0.9845728014058839\n","recall: 0.9905837957824639\n","f1_macro: 0.920774682217114\n","neg_log loss: -0.06387190802392176\n"]}],"source":["import pandas as pd\n","import numpy as np\n","import xgboost as xgb\n","import logging\n","from tqdm.notebook import tqdm\n","from gensim.models import Word2Vec\n","from sklearn.feature_extraction.text import TfidfVectorizer\n","from sklearn.model_selection import train_test_split\n","from sklearn.model_selection import StratifiedKFold\n","from sklearn.model_selection import cross_validate\n","from sklearn.metrics import classification_report\n","datasets = pd.read_csv(\"./drive/MyDrive/evmbytecodes.csv\", names=(\"label\", \"evmcode\")) #データセット読み込み\n","\n","# word2vec parameters\n","num_features    = 1600\n","min_word_count  = 5\n","num_workers     = 40\n","context         = 10\n","downsampling    = 1e-3\n","model_name = \"evmcode_feature200.model\"\n","\n","# コーパス読み込み\n","corpus = []\n","tfidf_X = []\n","\n","# TF_IDFによる文書ベクトルの生成\n","vectorizer = TfidfVectorizer(max_features = num_features)\n","tfidf_X = vectorizer.fit_transform(datasets[\"evmcode\"])\n","print(tfidf_X.shape)\n","tfidf_data_X = pd.DataFrame(tfidf_X.toarray(),columns=[\"tfidf_X\"+str(i) for i in range(tfidf_X.shape[1])])\n","for doc in tqdm(datasets[\"evmcode\"]):\n","    corpus.append(doc.split(\" \"))\n","\n","# word2vecモデルの作成＆モデルの保存\n","print(\"creating word2vec model ...\")\n","logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)\n","model = Word2Vec(corpus,size = num_features,alpha=0.025,window=5,min_count=5,workers=4,min_alpha=0.001)\n","model.train(corpus,total_examples=len(corpus),epochs=50)\n","model.save(model_name)\n","print(\"Done.\")\n","\n","# word2vecによる文書ベクトルの生成\n","def wordvec2docvec(sentence,model):\n","    # 文章ベクトルの初期値（0ベクトルを初期値とする）\n","    docvecs = np.zeros(num_features, dtype=\"float32\")\n","    # 文章に現れる単語のうち、モデルに存在しない単語をカウントする\n","    denomenator = len(sentence)\n","    # 文章内の各単語ベクトルを足し合わせる\n","    for word in sentence:\n","        try:\n","            temp = model.wv[word]\n","        except:\n","            denomenator -= 1\n","            continue\n","        docvecs += temp\n","    # 文章に現れる単語のうち、モデルに存在した単語の数で割る\n","    if denomenator > 0:\n","        docvecs =  docvecs / denomenator\n","    return docvecs\n","\n","print(len(datasets[\"evmcode\"]))\n","X, Y = [], []\n","for lb, code in tqdm(zip(datasets[\"label\"], datasets[\"evmcode\"])):\n","    docvec = wordvec2docvec(code.split(\" \"),model)\n","    X.append(list(docvec))\n","    Y.append(lb)\n","\n","# データフレームの構築\n","data_X = pd.DataFrame(X, columns=[\"X\" + str(i + 1) for i in range(num_features)])\n","data_Y = pd.DataFrame(Y, columns=[\"label_id\"])\n","data_TFIDF_W2V = pd.concat([data_X,tfidf_data_X],axis=1)\n","print(data_TFIDF_W2V)\n","print(data_Y)\n","\n","# テストデータの分割（層化5分割）\n","skf = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n","\n","# 評価指標\n","score_funcs = [\n","    'accuracy',\n","    'precision',\n","    'recall',\n","    'f1_macro',\n","    'neg_log_loss'\n","]\n","\n","# XGboostモデルの学習\n","print(\"Fitting XGboost model ...\")\n","xgb_model = xgb.XGBClassifier()\n","xgb_model.fit(data_TFIDF_W2V, data_Y)\n","print(\"Done.\")\n","\n","# 交差検証\n","scores = cross_validate(xgb_model, data_TFIDF_W2V, data_Y, cv=skf, scoring=score_funcs)\n","print('accuracy:', scores['test_accuracy'].mean())\n","print('precision:', scores['test_precision'].mean())\n","print('recall:', scores['test_recall'].mean())\n","print('f1_macro:', scores['test_f1_macro'].mean())\n","print('neg_log loss:', scores['test_neg_log_loss'].mean())"]}]}