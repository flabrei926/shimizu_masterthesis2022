{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"mount_file_id":"1ZUFBz5Jwx_tcJqXll1PMvIkR1_Q1lyXS","authorship_tag":"ABX9TyNHKyViWby8eLwYnJaJSQ8i"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"a0a94049400f46378f47dee3a874a79d":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_c28277dbb7574439956916fa2a399f9c","IPY_MODEL_da49b7fb0a394becb4f72929b00c12d8","IPY_MODEL_3447b3b1601b43379bee577fcaa8056f"],"layout":"IPY_MODEL_226462919e9a47f9ae134fb89a115a68"}},"c28277dbb7574439956916fa2a399f9c":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_658fe3dc68c8416eba61771fd6048b65","placeholder":"​","style":"IPY_MODEL_9eac43288a8c428f8599dcb64c01a490","value":"100%"}},"da49b7fb0a394becb4f72929b00c12d8":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_b298af3571f84acaa47780b3de9a1daf","max":2313,"min":0,"orientation":"horizontal","style":"IPY_MODEL_4c2f0ff8094948268fa2cf8301e464ef","value":2313}},"3447b3b1601b43379bee577fcaa8056f":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_94512dadf2dc44559635e2521cc75a9b","placeholder":"​","style":"IPY_MODEL_94fb45e80c6440bab5099f4bfa6737c4","value":" 2313/2313 [00:01&lt;00:00, 1249.65it/s]"}},"226462919e9a47f9ae134fb89a115a68":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"658fe3dc68c8416eba61771fd6048b65":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9eac43288a8c428f8599dcb64c01a490":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"b298af3571f84acaa47780b3de9a1daf":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4c2f0ff8094948268fa2cf8301e464ef":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"94512dadf2dc44559635e2521cc75a9b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"94fb45e80c6440bab5099f4bfa6737c4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"d87ef84d66c24594be9b7c7f69451524":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_03e48b6726de4b20a9d010b86ce46fd6","IPY_MODEL_759a30d27b8c43c4bfb7b52d00f91ca5","IPY_MODEL_1de9f0c8622c41a3b97b13aab86c6c73"],"layout":"IPY_MODEL_6243f63c4d6645168045a1340b134f59"}},"03e48b6726de4b20a9d010b86ce46fd6":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_eae89433c357499f97d4e219677f56f6","placeholder":"​","style":"IPY_MODEL_e4815cba59534283819c895387a58e04","value":""}},"759a30d27b8c43c4bfb7b52d00f91ca5":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_87cbb5400c494ae78336561f59986b50","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_2a6c544953bb47fbbb63d20459dba3a5","value":1}},"1de9f0c8622c41a3b97b13aab86c6c73":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_dc9e6c76ac644521abb0f24c94ada89a","placeholder":"​","style":"IPY_MODEL_ffeec98a81e94887b587ddfb8b236294","value":" 2313/? [00:25&lt;00:00, 73.73it/s]"}},"6243f63c4d6645168045a1340b134f59":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"eae89433c357499f97d4e219677f56f6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e4815cba59534283819c895387a58e04":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"87cbb5400c494ae78336561f59986b50":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"2a6c544953bb47fbbb63d20459dba3a5":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"dc9e6c76ac644521abb0f24c94ada89a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ffeec98a81e94887b587ddfb8b236294":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["a0a94049400f46378f47dee3a874a79d","c28277dbb7574439956916fa2a399f9c","da49b7fb0a394becb4f72929b00c12d8","3447b3b1601b43379bee577fcaa8056f","226462919e9a47f9ae134fb89a115a68","658fe3dc68c8416eba61771fd6048b65","9eac43288a8c428f8599dcb64c01a490","b298af3571f84acaa47780b3de9a1daf","4c2f0ff8094948268fa2cf8301e464ef","94512dadf2dc44559635e2521cc75a9b","94fb45e80c6440bab5099f4bfa6737c4","d87ef84d66c24594be9b7c7f69451524","03e48b6726de4b20a9d010b86ce46fd6","759a30d27b8c43c4bfb7b52d00f91ca5","1de9f0c8622c41a3b97b13aab86c6c73","6243f63c4d6645168045a1340b134f59","eae89433c357499f97d4e219677f56f6","e4815cba59534283819c895387a58e04","87cbb5400c494ae78336561f59986b50","2a6c544953bb47fbbb63d20459dba3a5","dc9e6c76ac644521abb0f24c94ada89a","ffeec98a81e94887b587ddfb8b236294"]},"id":"fh5uPctSmTF-","executionInfo":{"status":"ok","timestamp":1675673343062,"user_tz":-540,"elapsed":657853,"user":{"displayName":"清水嶺","userId":"11678528705416048401"}},"outputId":"97438794-4ab0-41c4-d3ff-d216115ec098"},"outputs":[{"output_type":"stream","name":"stdout","text":["(2313, 800)\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/2313 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"a0a94049400f46378f47dee3a874a79d"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["creating word2vec model ...\n"]},{"output_type":"stream","name":"stderr","text":["WARNING:gensim.models.base_any2vec:Effective 'alpha' higher than previous training cycles\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n","2313\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"d87ef84d66c24594be9b7c7f69451524"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["            X1        X2        X3        X4        X5        X6        X7  \\\n","0    -0.205032 -0.341590  0.751179  0.123431  0.010352 -0.757414  0.324003   \n","1    -0.221666 -0.309074  0.839128 -0.013388  0.009701 -0.814211  0.489372   \n","2    -0.157410 -0.345830  0.812071  0.075300 -0.030816 -0.838166  0.395700   \n","3    -0.159112 -0.345732  0.817483  0.077605 -0.030102 -0.839748  0.397094   \n","4    -0.151922 -0.320668  0.776350  0.120527 -0.006158 -0.866113  0.397286   \n","...        ...       ...       ...       ...       ...       ...       ...   \n","2308 -0.256902 -0.393887  0.690513  0.096018 -0.045408 -0.653823  0.235059   \n","2309 -0.167307 -0.334893  0.730359  0.136651 -0.011175 -0.758092  0.339480   \n","2310 -0.162703 -0.352922  0.775309  0.144518 -0.018547 -0.846780  0.356843   \n","2311 -0.263571 -0.398268  0.717572  0.099260 -0.101469 -0.645720  0.219466   \n","2312 -0.249923 -0.242115  0.525235  0.139913  0.021012 -0.729064  0.287350   \n","\n","            X8        X9       X10  ...  tfidf_X790  tfidf_X791  tfidf_X792  \\\n","0    -0.603760  0.454131  0.336348  ...    0.000866    0.092079    0.035747   \n","1    -0.627249  0.515900  0.092114  ...    0.000000    0.103521    0.030207   \n","2    -0.564008  0.460938  0.137540  ...    0.000000    0.127743    0.060065   \n","3    -0.564120  0.462974  0.137772  ...    0.000000    0.124864    0.060527   \n","4    -0.510723  0.440730  0.133700  ...    0.000000    0.107123    0.043996   \n","...        ...       ...       ...  ...         ...         ...         ...   \n","2308 -0.589403  0.414580  0.313121  ...    0.000000    0.106930    0.027621   \n","2309 -0.562518  0.370867  0.313782  ...    0.000000    0.099895    0.048455   \n","2310 -0.524940  0.449093  0.179154  ...    0.000000    0.129503    0.025795   \n","2311 -0.614148  0.392587  0.338169  ...    0.000000    0.099081    0.036045   \n","2312 -0.408588  0.367368  0.271819  ...    0.000000    0.001310    0.000000   \n","\n","      tfidf_X793  tfidf_X794  tfidf_X795  tfidf_X796  tfidf_X797  tfidf_X798  \\\n","0       0.018609    0.018046    0.011086    0.009055    0.003507    0.007105   \n","1       0.008653    0.000000    0.000000    0.000000    0.000000    0.000000   \n","2       0.005125    0.000000    0.002378    0.000000    0.000000    0.000000   \n","3       0.005165    0.000000    0.002396    0.000000    0.000000    0.000000   \n","4       0.002262    0.000000    0.000000    0.000000    0.000000    0.000000   \n","...          ...         ...         ...         ...         ...         ...   \n","2308    0.014945    0.017665    0.008158    0.008662    0.009393    0.001699   \n","2309    0.030363    0.053614    0.018783    0.016620    0.012358    0.007825   \n","2310    0.006465    0.001074    0.000000    0.000000    0.000000    0.000000   \n","2311    0.024093    0.030256    0.005589    0.000000    0.000000    0.000000   \n","2312    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000   \n","\n","      tfidf_X799  \n","0       0.004953  \n","1       0.005829  \n","2       0.000000  \n","3       0.000000  \n","4       0.000000  \n","...          ...  \n","2308    0.011845  \n","2309    0.000000  \n","2310    0.000000  \n","2311    0.000000  \n","2312    0.021250  \n","\n","[2313 rows x 1600 columns]\n","      label_id\n","0            0\n","1            0\n","2            0\n","3            0\n","4            0\n","...        ...\n","2308         1\n","2309         1\n","2310         1\n","2311         1\n","2312         1\n","\n","[2313 rows x 1 columns]\n","Fitting XGboost model ...\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["accuracy: 0.9792469589445831\n","precision: 0.9859690404100137\n","recall: 0.9915238623751387\n","f1_macro: 0.9285654752127227\n","neg_log loss: -0.05588879703715022\n"]}],"source":["import pandas as pd\n","import numpy as np\n","import xgboost as xgb\n","import logging\n","from tqdm.notebook import tqdm\n","from gensim.models import Word2Vec\n","from sklearn.feature_extraction.text import TfidfVectorizer\n","from sklearn.model_selection import train_test_split\n","from sklearn.model_selection import StratifiedKFold\n","from sklearn.model_selection import cross_validate\n","from sklearn.metrics import classification_report\n","datasets = pd.read_csv(\"./drive/MyDrive/evmbytecodes.csv\", names=(\"label\", \"evmcode\")) #データセット読み込み\n","\n","# word2vec parameters\n","num_features    = 800\n","min_word_count  = 5\n","num_workers     = 40\n","context         = 10\n","downsampling    = 1e-3\n","model_name = \"evmcode_feature200.model\"\n","\n","# コーパス読み込み\n","corpus = []\n","tfidf_X = []\n","\n","# TF_IDFによる文書ベクトルの生成\n","vectorizer = TfidfVectorizer(max_features = num_features)\n","tfidf_X = vectorizer.fit_transform(datasets[\"evmcode\"])\n","print(tfidf_X.shape)\n","tfidf_data_X = pd.DataFrame(tfidf_X.toarray(),columns=[\"tfidf_X\"+str(i) for i in range(tfidf_X.shape[1])])\n","for doc in tqdm(datasets[\"evmcode\"]):\n","    corpus.append(doc.split(\" \"))\n","\n","# word2vecモデルの作成＆モデルの保存\n","print(\"creating word2vec model ...\")\n","logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)\n","model = Word2Vec(corpus,size = num_features,alpha=0.025,window=5,min_count=5,workers=4,min_alpha=0.001)\n","model.train(corpus,total_examples=len(corpus),epochs=50)\n","model.save(model_name)\n","print(\"Done.\")\n","\n","# word2vecによる文書ベクトルの生成\n","def wordvec2docvec(sentence,model):\n","    # 文章ベクトルの初期値（0ベクトルを初期値とする）\n","    docvecs = np.zeros(num_features, dtype=\"float32\")\n","    # 文章に現れる単語のうち、モデルに存在しない単語をカウントする\n","    denomenator = len(sentence)\n","    # 文章内の各単語ベクトルを足し合わせる\n","    for word in sentence:\n","        try:\n","            temp = model.wv[word]\n","        except:\n","            denomenator -= 1\n","            continue\n","        docvecs += temp\n","    # 文章に現れる単語のうち、モデルに存在した単語の数で割る\n","    if denomenator > 0:\n","        docvecs =  docvecs / denomenator\n","    return docvecs\n","\n","print(len(datasets[\"evmcode\"]))\n","X, Y = [], []\n","for lb, code in tqdm(zip(datasets[\"label\"], datasets[\"evmcode\"])):\n","    docvec = wordvec2docvec(code.split(\" \"),model)\n","    X.append(list(docvec))\n","    Y.append(lb)\n","\n","# データフレームの構築\n","data_X = pd.DataFrame(X, columns=[\"X\" + str(i + 1) for i in range(num_features)])\n","data_Y = pd.DataFrame(Y, columns=[\"label_id\"])\n","data_TFIDF_W2V = pd.concat([data_X,tfidf_data_X],axis=1)\n","print(data_TFIDF_W2V)\n","print(data_Y)\n","\n","# テストデータの分割（層化5分割）\n","skf = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n","\n","# 評価指標\n","score_funcs = [\n","    'accuracy',\n","    'precision',\n","    'recall',\n","    'f1_macro',\n","    'neg_log_loss'\n","]\n","\n","# XGboostモデルの学習\n","print(\"Fitting XGboost model ...\")\n","xgb_model = xgb.XGBClassifier()\n","xgb_model.fit(data_TFIDF_W2V, data_Y)\n","print(\"Done.\")\n","\n","# 交差検証\n","scores = cross_validate(xgb_model, data_TFIDF_W2V, data_Y, cv=skf, scoring=score_funcs)\n","print('accuracy:', scores['test_accuracy'].mean())\n","print('precision:', scores['test_precision'].mean())\n","print('recall:', scores['test_recall'].mean())\n","print('f1_macro:', scores['test_f1_macro'].mean())\n","print('neg_log loss:', scores['test_neg_log_loss'].mean())"]}]}