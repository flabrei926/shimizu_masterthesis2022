{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"mount_file_id":"1ZJ8SjNnazfssdi1MGB2Y0RCQw-bUVWXw","authorship_tag":"ABX9TyP05j7R2wGxXFqZepjgCCI1"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"71e8d65ca5804747acc0c33e00b4e766":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_181a8c5c9a28427c96bd279bdc245d57","IPY_MODEL_d690912d1463448d88df87d3cbc9e7b6","IPY_MODEL_3b7281b17c3c4538b60cde77673a6529"],"layout":"IPY_MODEL_48a9b5e5918543ddacdb17316eefad41"}},"181a8c5c9a28427c96bd279bdc245d57":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_3e011f86c71342e58d7dc7b6f7d26a05","placeholder":"​","style":"IPY_MODEL_1013015cedb94651bc77ab9fb0729db4","value":"100%"}},"d690912d1463448d88df87d3cbc9e7b6":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_627498175f3c448694dd70c05774ee38","max":2313,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b44b5502d4f54952abe0a32f381de0df","value":2313}},"3b7281b17c3c4538b60cde77673a6529":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_21b9ce5d62bf4188bbf044c3a4b6b4c0","placeholder":"​","style":"IPY_MODEL_13bd254d4427466e9f3d7c35160b88cb","value":" 2313/2313 [00:01&lt;00:00, 2580.63it/s]"}},"48a9b5e5918543ddacdb17316eefad41":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3e011f86c71342e58d7dc7b6f7d26a05":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1013015cedb94651bc77ab9fb0729db4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"627498175f3c448694dd70c05774ee38":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b44b5502d4f54952abe0a32f381de0df":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"21b9ce5d62bf4188bbf044c3a4b6b4c0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"13bd254d4427466e9f3d7c35160b88cb":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"1aa77c95b4384b5aa5c6c88ca1f6a4f7":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a6896ee14fdb49faa836daf7864740ca","IPY_MODEL_14ffd004b07c49cbbb6aaeea3d66ea02","IPY_MODEL_8da7a46c45f2443d96a9e4b459ab4f93"],"layout":"IPY_MODEL_a267cdc710704cc0a909b6d63228e6d3"}},"a6896ee14fdb49faa836daf7864740ca":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_8f42b244006b42a0bdc061f57a8b085e","placeholder":"​","style":"IPY_MODEL_b8755ea59a58478c90603441061afada","value":""}},"14ffd004b07c49cbbb6aaeea3d66ea02":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_5fe074e2deca4a26b39e9745538fa86c","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_b7e8cec2c13a4c848d55e866d0a6a8af","value":1}},"8da7a46c45f2443d96a9e4b459ab4f93":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f34290a77c994e57965a222cf4147f34","placeholder":"​","style":"IPY_MODEL_41e9bccce27d4d22a85431cdb29ed331","value":" 2313/? [00:28&lt;00:00, 69.01it/s]"}},"a267cdc710704cc0a909b6d63228e6d3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8f42b244006b42a0bdc061f57a8b085e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b8755ea59a58478c90603441061afada":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5fe074e2deca4a26b39e9745538fa86c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"b7e8cec2c13a4c848d55e866d0a6a8af":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"f34290a77c994e57965a222cf4147f34":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"41e9bccce27d4d22a85431cdb29ed331":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["71e8d65ca5804747acc0c33e00b4e766","181a8c5c9a28427c96bd279bdc245d57","d690912d1463448d88df87d3cbc9e7b6","3b7281b17c3c4538b60cde77673a6529","48a9b5e5918543ddacdb17316eefad41","3e011f86c71342e58d7dc7b6f7d26a05","1013015cedb94651bc77ab9fb0729db4","627498175f3c448694dd70c05774ee38","b44b5502d4f54952abe0a32f381de0df","21b9ce5d62bf4188bbf044c3a4b6b4c0","13bd254d4427466e9f3d7c35160b88cb","1aa77c95b4384b5aa5c6c88ca1f6a4f7","a6896ee14fdb49faa836daf7864740ca","14ffd004b07c49cbbb6aaeea3d66ea02","8da7a46c45f2443d96a9e4b459ab4f93","a267cdc710704cc0a909b6d63228e6d3","8f42b244006b42a0bdc061f57a8b085e","b8755ea59a58478c90603441061afada","5fe074e2deca4a26b39e9745538fa86c","b7e8cec2c13a4c848d55e866d0a6a8af","f34290a77c994e57965a222cf4147f34","41e9bccce27d4d22a85431cdb29ed331"]},"id":"m-Gt4KIXmpXe","executionInfo":{"status":"ok","timestamp":1675585788653,"user_tz":-540,"elapsed":1063515,"user":{"displayName":"清水嶺","userId":"11678528705416048401"}},"outputId":"99f8f711-6d56-4294-9c16-16adc03050f8"},"outputs":[{"output_type":"stream","name":"stdout","text":["(2313, 1200)\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/2313 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"71e8d65ca5804747acc0c33e00b4e766"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["creating word2vec model ...\n"]},{"output_type":"stream","name":"stderr","text":["WARNING:gensim.models.base_any2vec:Effective 'alpha' higher than previous training cycles\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n","2313\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"1aa77c95b4384b5aa5c6c88ca1f6a4f7"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["            X1        X2        X3        X4        X5        X6        X7  \\\n","0    -0.392974  0.005931 -0.109702  0.017134  0.007065  0.506608  0.326013   \n","1    -0.590891 -0.016906 -0.196979  0.165673 -0.084140  0.464330  0.393583   \n","2    -0.557314  0.032155 -0.168670  0.212194 -0.043594  0.416244  0.378864   \n","3    -0.556253  0.036794 -0.171506  0.210256 -0.045950  0.418617  0.381932   \n","4    -0.548502  0.096072 -0.177341  0.150380 -0.030977  0.382031  0.339582   \n","...        ...       ...       ...       ...       ...       ...       ...   \n","2308 -0.349754 -0.088978 -0.056102  0.118095 -0.003515  0.499156  0.367681   \n","2309 -0.374640  0.042876 -0.111116  0.022976 -0.017147  0.484453  0.332872   \n","2310 -0.551118  0.094464 -0.171238  0.155241 -0.009164  0.395654  0.376106   \n","2311 -0.327227 -0.097567 -0.048728  0.100511  0.014202  0.521628  0.380528   \n","2312 -0.390101  0.036249 -0.062896  0.033716  0.009096  0.424682  0.229370   \n","\n","            X8        X9       X10  ...  tfidf_X1190  tfidf_X1191  \\\n","0    -0.063450 -0.287238  0.284455  ...          0.0     0.092065   \n","1    -0.015917 -0.483248  0.224201  ...          0.0     0.103487   \n","2    -0.012730 -0.420903  0.249064  ...          0.0     0.127694   \n","3    -0.013289 -0.421589  0.248311  ...          0.0     0.124828   \n","4    -0.008432 -0.441126  0.271371  ...          0.0     0.107098   \n","...        ...       ...       ...  ...          ...          ...   \n","2308 -0.121745 -0.201805  0.214959  ...          0.0     0.106901   \n","2309 -0.073628 -0.312242  0.263086  ...          0.0     0.099878   \n","2310  0.005371 -0.435329  0.283001  ...          0.0     0.129498   \n","2311 -0.106406 -0.187965  0.224876  ...          0.0     0.098976   \n","2312 -0.161455 -0.270225  0.170324  ...          0.0     0.001291   \n","\n","      tfidf_X1192  tfidf_X1193  tfidf_X1194  tfidf_X1195  tfidf_X1196  \\\n","0        0.035742     0.018607     0.018043     0.011084     0.009053   \n","1        0.030197     0.008650     0.000000     0.000000     0.000000   \n","2        0.060042     0.005123     0.000000     0.002377     0.000000   \n","3        0.060510     0.005163     0.000000     0.002395     0.000000   \n","4        0.043986     0.002262     0.000000     0.000000     0.000000   \n","...           ...          ...          ...          ...          ...   \n","2308     0.027613     0.014941     0.017660     0.008155     0.008660   \n","2309     0.048447     0.030358     0.053605     0.018779     0.016617   \n","2310     0.025794     0.006465     0.001074     0.000000     0.000000   \n","2311     0.036007     0.024067     0.030224     0.005583     0.000000   \n","2312     0.000000     0.000000     0.000000     0.000000     0.000000   \n","\n","      tfidf_X1197  tfidf_X1198  tfidf_X1199  \n","0        0.003506     0.007104     0.004952  \n","1        0.000000     0.000000     0.005827  \n","2        0.000000     0.000000     0.000000  \n","3        0.000000     0.000000     0.000000  \n","4        0.000000     0.000000     0.000000  \n","...           ...          ...          ...  \n","2308     0.009390     0.001699     0.011842  \n","2309     0.012356     0.007824     0.000000  \n","2310     0.000000     0.000000     0.000000  \n","2311     0.000000     0.000000     0.000000  \n","2312     0.000000     0.000000     0.020941  \n","\n","[2313 rows x 2400 columns]\n","      label_id\n","0            0\n","1            0\n","2            0\n","3            0\n","4            0\n","...        ...\n","2308         1\n","2309         1\n","2310         1\n","2311         1\n","2312         1\n","\n","[2313 rows x 1 columns]\n","Fitting XGboost model ...\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["accuracy: 0.977082456780081\n","precision: 0.9854821334242742\n","recall: 0.9896403995560489\n","f1_macro: 0.9215692065533932\n","neg_log loss: -0.0588924949827892\n"]}],"source":["import pandas as pd\n","import numpy as np\n","import xgboost as xgb\n","import logging\n","from tqdm.notebook import tqdm\n","from gensim.models import Word2Vec\n","from sklearn.feature_extraction.text import TfidfVectorizer\n","from sklearn.model_selection import train_test_split\n","from sklearn.model_selection import StratifiedKFold\n","from sklearn.model_selection import cross_validate\n","from sklearn.metrics import classification_report\n","datasets = pd.read_csv(\"./drive/MyDrive/evmbytecodes.csv\", names=(\"label\", \"evmcode\")) #データセット読み込み\n","\n","# word2vec parameters\n","num_features    = 1200\n","min_word_count  = 5\n","num_workers     = 40\n","context         = 10\n","downsampling    = 1e-3\n","model_name = \"evmcode_feature200.model\"\n","\n","# コーパス読み込み\n","corpus = []\n","tfidf_X = []\n","\n","# TF_IDFによる文書ベクトルの生成\n","vectorizer = TfidfVectorizer(max_features = num_features)\n","tfidf_X = vectorizer.fit_transform(datasets[\"evmcode\"])\n","print(tfidf_X.shape)\n","tfidf_data_X = pd.DataFrame(tfidf_X.toarray(),columns=[\"tfidf_X\"+str(i) for i in range(tfidf_X.shape[1])])\n","for doc in tqdm(datasets[\"evmcode\"]):\n","    corpus.append(doc.split(\" \"))\n","\n","# word2vecモデルの作成＆モデルの保存\n","print(\"creating word2vec model ...\")\n","logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)\n","model = Word2Vec(corpus,size = num_features,alpha=0.025,window=5,min_count=5,workers=4,min_alpha=0.001)\n","model.train(corpus,total_examples=len(corpus),epochs=50)\n","model.save(model_name)\n","print(\"Done.\")\n","\n","# word2vecによる文書ベクトルの生成\n","def wordvec2docvec(sentence,model):\n","    # 文章ベクトルの初期値（0ベクトルを初期値とする）\n","    docvecs = np.zeros(num_features, dtype=\"float32\")\n","    # 文章に現れる単語のうち、モデルに存在しない単語をカウントする\n","    denomenator = len(sentence)\n","    # 文章内の各単語ベクトルを足し合わせる\n","    for word in sentence:\n","        try:\n","            temp = model.wv[word]\n","        except:\n","            denomenator -= 1\n","            continue\n","        docvecs += temp\n","    # 文章に現れる単語のうち、モデルに存在した単語の数で割る\n","    if denomenator > 0:\n","        docvecs =  docvecs / denomenator\n","    return docvecs\n","\n","print(len(datasets[\"evmcode\"]))\n","X, Y = [], []\n","for lb, code in tqdm(zip(datasets[\"label\"], datasets[\"evmcode\"])):\n","    docvec = wordvec2docvec(code.split(\" \"),model)\n","    X.append(list(docvec))\n","    Y.append(lb)\n","\n","# データフレームの構築\n","data_X = pd.DataFrame(X, columns=[\"X\" + str(i + 1) for i in range(num_features)])\n","data_Y = pd.DataFrame(Y, columns=[\"label_id\"])\n","data_TFIDF_W2V = pd.concat([data_X,tfidf_data_X],axis=1)\n","print(data_TFIDF_W2V)\n","print(data_Y)\n","\n","# テストデータの分割（層化5分割）\n","skf = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n","\n","# 評価指標\n","score_funcs = [\n","    'accuracy',\n","    'precision',\n","    'recall',\n","    'f1_macro',\n","    'neg_log_loss'\n","]\n","\n","# XGboostモデルの学習\n","print(\"Fitting XGboost model ...\")\n","xgb_model = xgb.XGBClassifier()\n","xgb_model.fit(data_TFIDF_W2V, data_Y)\n","print(\"Done.\")\n","\n","# 交差検証\n","scores = cross_validate(xgb_model, data_TFIDF_W2V, data_Y, cv=skf, scoring=score_funcs)\n","print('accuracy:', scores['test_accuracy'].mean())\n","print('precision:', scores['test_precision'].mean())\n","print('recall:', scores['test_recall'].mean())\n","print('f1_macro:', scores['test_f1_macro'].mean())\n","print('neg_log loss:', scores['test_neg_log_loss'].mean())"]}]}