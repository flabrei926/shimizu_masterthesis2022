{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"mount_file_id":"1KBt-V6gHRPTPTPhs-TYHZjG-oha1ao7H","authorship_tag":"ABX9TyNvWNxhQNL/eAbpnSBl5/gN"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"613d526883534d81a078b626784985b9":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_877da443e2884fcc95894f44a5263457","IPY_MODEL_048689e29b0d492db32b207a1daa2361","IPY_MODEL_bd0fcd43befd42f399488c69e19a51b9"],"layout":"IPY_MODEL_31f111cbb705429aa1dc3692154b199e"}},"877da443e2884fcc95894f44a5263457":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_00745c064daa437d8571a533a6a7de0e","placeholder":"​","style":"IPY_MODEL_a27c1d866d1d41af83d6abd82cfc615b","value":"100%"}},"048689e29b0d492db32b207a1daa2361":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_0c25b5cf1e114315bd421f90fad99db8","max":2313,"min":0,"orientation":"horizontal","style":"IPY_MODEL_c376db67702c4bb1a5b9f15d4858dfd4","value":2313}},"bd0fcd43befd42f399488c69e19a51b9":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_3c488aeee281435faf65c32004d81fe4","placeholder":"​","style":"IPY_MODEL_62a29d02eab74a27980a2815702877b2","value":" 2313/2313 [00:01&lt;00:00, 2595.15it/s]"}},"31f111cbb705429aa1dc3692154b199e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"00745c064daa437d8571a533a6a7de0e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a27c1d866d1d41af83d6abd82cfc615b":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"0c25b5cf1e114315bd421f90fad99db8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c376db67702c4bb1a5b9f15d4858dfd4":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"3c488aeee281435faf65c32004d81fe4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"62a29d02eab74a27980a2815702877b2":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"fef860a6ed6b4dc687e3be73ddfec88e":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_c023a4bb4bdb47e3b17a401ccb80f358","IPY_MODEL_c354bb76ce0847569f07d5187c3d108d","IPY_MODEL_e04fb2e0f88349bda594f47db6b3b438"],"layout":"IPY_MODEL_ddb081d070874d9ba7a235987b5c4838"}},"c023a4bb4bdb47e3b17a401ccb80f358":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_bad1a7d7f83d48128d8ca63fc52b94dd","placeholder":"​","style":"IPY_MODEL_06489837531c411184610c8732cbdd04","value":""}},"c354bb76ce0847569f07d5187c3d108d":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_bbe8f4e7950442588aef20c7ff734344","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_ebff0effb1fd467ca8fb35d401110d8d","value":1}},"e04fb2e0f88349bda594f47db6b3b438":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_fc4cdf6b01ad46e0aab76617e32c468e","placeholder":"​","style":"IPY_MODEL_a3de5b0374c5443e84b221a0f2a2f783","value":" 2313/? [00:26&lt;00:00, 75.77it/s]"}},"ddb081d070874d9ba7a235987b5c4838":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"bad1a7d7f83d48128d8ca63fc52b94dd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"06489837531c411184610c8732cbdd04":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"bbe8f4e7950442588aef20c7ff734344":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"ebff0effb1fd467ca8fb35d401110d8d":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"fc4cdf6b01ad46e0aab76617e32c468e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a3de5b0374c5443e84b221a0f2a2f783":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["613d526883534d81a078b626784985b9","877da443e2884fcc95894f44a5263457","048689e29b0d492db32b207a1daa2361","bd0fcd43befd42f399488c69e19a51b9","31f111cbb705429aa1dc3692154b199e","00745c064daa437d8571a533a6a7de0e","a27c1d866d1d41af83d6abd82cfc615b","0c25b5cf1e114315bd421f90fad99db8","c376db67702c4bb1a5b9f15d4858dfd4","3c488aeee281435faf65c32004d81fe4","62a29d02eab74a27980a2815702877b2","fef860a6ed6b4dc687e3be73ddfec88e","c023a4bb4bdb47e3b17a401ccb80f358","c354bb76ce0847569f07d5187c3d108d","e04fb2e0f88349bda594f47db6b3b438","ddb081d070874d9ba7a235987b5c4838","bad1a7d7f83d48128d8ca63fc52b94dd","06489837531c411184610c8732cbdd04","bbe8f4e7950442588aef20c7ff734344","ebff0effb1fd467ca8fb35d401110d8d","fc4cdf6b01ad46e0aab76617e32c468e","a3de5b0374c5443e84b221a0f2a2f783"]},"id":"wvNWzx9Gy-JZ","executionInfo":{"status":"ok","timestamp":1675582452753,"user_tz":-540,"elapsed":400797,"user":{"displayName":"清水嶺","userId":"11678528705416048401"}},"outputId":"c1f4f9ee-7a8b-4bc8-d295-b3686e3a63eb"},"outputs":[{"output_type":"stream","name":"stdout","text":["(2313, 200)\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/2313 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"613d526883534d81a078b626784985b9"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["creating word2vec model ...\n"]},{"output_type":"stream","name":"stderr","text":["WARNING:gensim.models.base_any2vec:Effective 'alpha' higher than previous training cycles\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n","2313\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"fef860a6ed6b4dc687e3be73ddfec88e"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["            X1        X2        X3        X4        X5        X6        X7  \\\n","0     0.604372 -0.293656  0.305908 -0.125674  0.936426  0.167326 -0.916526   \n","1     0.651481 -0.529892  0.386644 -0.317475  0.838959  0.232502 -0.825761   \n","2     0.632597 -0.388357  0.380824 -0.206899  0.730898  0.230956 -0.821525   \n","3     0.632738 -0.387925  0.377702 -0.208524  0.733241  0.230142 -0.816782   \n","4     0.590041 -0.319836  0.396016 -0.157053  0.701989  0.219546 -0.785936   \n","...        ...       ...       ...       ...       ...       ...       ...   \n","2308  0.457580 -0.264181  0.325520 -0.201042  0.795541  0.196384 -0.902562   \n","2309  0.591622 -0.334822  0.323678 -0.145939  0.992382  0.187939 -0.839149   \n","2310  0.612299 -0.293182  0.404636 -0.121595  0.653830  0.212421 -0.843166   \n","2311  0.452600 -0.325135  0.295009 -0.180000  0.855406  0.142652 -0.897447   \n","2312  0.285872  0.089181  0.452374 -0.211295  0.540120  0.335870 -0.695559   \n","\n","            X8        X9       X10  ...  tfidf_X190  tfidf_X191  tfidf_X192  \\\n","0    -0.057733 -0.973427 -0.250101  ...    0.022680    0.000251    0.106529   \n","1    -0.312075 -1.187394  0.154636  ...    0.019409    0.009434    0.058226   \n","2    -0.193126 -0.857160 -0.045283  ...    0.019156    0.009777    0.081733   \n","3    -0.189775 -0.858492 -0.044781  ...    0.019304    0.009853    0.081076   \n","4    -0.171350 -0.763461 -0.087233  ...    0.023673    0.014795    0.068764   \n","...        ...       ...       ...  ...         ...         ...         ...   \n","2308  0.073684 -0.741333 -0.203203  ...    0.012268    0.001438    0.105593   \n","2309 -0.108497 -0.931091 -0.238684  ...    0.021191    0.002207    0.092838   \n","2310 -0.128118 -0.721929 -0.193669  ...    0.011716    0.012814    0.063269   \n","2311  0.109618 -0.856395 -0.219474  ...    0.015039    0.004934    0.135347   \n","2312  0.162574 -0.480696 -0.281662  ...    0.024798    0.037669    0.024798   \n","\n","      tfidf_X193  tfidf_X194  tfidf_X195  tfidf_X196  tfidf_X197  tfidf_X198  \\\n","0       0.238028    0.092135    0.035770    0.018621    0.018057    0.011092   \n","1       0.284659    0.103557    0.030217    0.008656    0.000000    0.000000   \n","2       0.295005    0.127763    0.060075    0.005126    0.000000    0.002378   \n","3       0.295992    0.124886    0.060538    0.005166    0.000000    0.002397   \n","4       0.286329    0.107138    0.044002    0.002262    0.000000    0.000000   \n","...          ...         ...         ...         ...         ...         ...   \n","2308    0.238351    0.106954    0.027627    0.014949    0.017669    0.008159   \n","2309    0.294659    0.099945    0.048479    0.030378    0.053641    0.018792   \n","2310    0.297597    0.129522    0.025798    0.006466    0.001074    0.000000   \n","2311    0.251143    0.099297    0.036124    0.024145    0.030322    0.005601   \n","2312    0.121234    0.001378    0.000000    0.000000    0.000000    0.000000   \n","\n","      tfidf_X199  \n","0       0.004956  \n","1       0.005831  \n","2       0.000000  \n","3       0.000000  \n","4       0.000000  \n","...          ...  \n","2308    0.011848  \n","2309    0.000000  \n","2310    0.000000  \n","2311    0.000000  \n","2312    0.022352  \n","\n","[2313 rows x 400 columns]\n","      label_id\n","0            0\n","1            0\n","2            0\n","3            0\n","4            0\n","...        ...\n","2308         1\n","2309         1\n","2310         1\n","2311         1\n","2312         1\n","\n","[2313 rows x 1 columns]\n","Fitting XGboost model ...\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n","              precision    recall  f1-score   support\n","\n","           0       0.85      0.78      0.82        60\n","           1       0.98      0.99      0.98       634\n","\n","    accuracy                           0.97       694\n","   macro avg       0.92      0.89      0.90       694\n","weighted avg       0.97      0.97      0.97       694\n","\n"]}],"source":["import pandas as pd\n","import numpy as np\n","import xgboost as xgb\n","import logging\n","from tqdm.notebook import tqdm\n","from gensim.models import Word2Vec\n","from scipy import spatial\n","from sklearn.feature_extraction.text import TfidfVectorizer\n","from sklearn.model_selection import train_test_split\n","from sklearn.model_selection import StratifiedKFold\n","from sklearn.model_selection import cross_validate\n","from sklearn.metrics import classification_report\n","datasets = pd.read_csv(\"./drive/MyDrive/evmbytecodes.csv\", names=(\"label\", \"evmcode\")) #データセット読み込み\n","\n","# word2vec parameters\n","num_features    = 200\n","min_word_count  = 5\n","num_workers     = 40\n","context         = 10\n","downsampling    = 1e-3\n","model_name = \"evmcode_feature200.model\"\n","\n","# コーパス読み込み\n","corpus = []\n","tfidf_X = []\n","\n","# TF_IDFによる文書ベクトルの生成\n","vectorizer = TfidfVectorizer(max_features=200)\n","tfidf_X = vectorizer.fit_transform(datasets[\"evmcode\"])\n","print(tfidf_X.shape)\n","tfidf_data_X = pd.DataFrame(tfidf_X.toarray(),columns=[\"tfidf_X\"+str(i) for i in range(tfidf_X.shape[1])])\n","for doc in tqdm(datasets[\"evmcode\"]):\n","    corpus.append(doc.split(\" \"))\n","\n","# word2vecモデルの作成＆モデルの保存\n","print(\"creating word2vec model ...\")\n","logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)\n","model = Word2Vec(corpus,size=200,alpha=0.025,window=5,min_count=5,workers=4,min_alpha=0.001)\n","model.train(corpus,total_examples=len(corpus),epochs=50)\n","model.save(model_name)\n","print(\"Done.\")\n","\n","# word2vecによる文書ベクトルの生成\n","def wordvec2docvec(sentence,model):\n","    # 文章ベクトルの初期値（0ベクトルを初期値とする）\n","    docvecs = np.zeros(num_features, dtype=\"float32\")\n","    # 文章に現れる単語のうち、モデルに存在しない単語をカウントする\n","    denomenator = len(sentence)\n","    # 文章内の各単語ベクトルを足し合わせる\n","    for word in sentence:\n","        try:\n","            temp = model.wv[word]\n","        except:\n","            denomenator -= 1\n","            continue\n","        docvecs += temp\n","    # 文章に現れる単語のうち、モデルに存在した単語の数で割る\n","    if denomenator > 0:\n","        docvecs =  docvecs / denomenator\n","    return docvecs\n","\n","print(len(datasets[\"evmcode\"]))\n","X, Y = [], []\n","for lb, code in tqdm(zip(datasets[\"label\"], datasets[\"evmcode\"])):\n","    docvec = wordvec2docvec(code.split(\" \"),model)\n","    X.append(list(docvec))\n","    Y.append(lb)\n","\n","# データフレームの構築\n","data_X = pd.DataFrame(X, columns=[\"X\" + str(i + 1) for i in range(num_features)])\n","data_Y = pd.DataFrame(Y, columns=[\"label_id\"])\n","data_TFIDF_W2V = pd.concat([data_X,tfidf_data_X],axis=1)\n","print(data_TFIDF_W2V)\n","print(data_Y)\n","\n","# テストデータの分割\n","train_x, test_x, train_y, test_y = train_test_split(data_TFIDF_W2V, data_Y, train_size= 0.7)\n","\n","# XGboostモデルの学習\n","print(\"Fitting XGboost model ...\")\n","xgb_model = xgb.XGBClassifier()\n","xgb_model.fit(train_x, train_y)\n","print(\"Done.\")\n","\n","# 検証\n","pred = xgb_model.predict(test_x)\n","for p, i, l in zip(pred, test_y.index, test_y[\"label_id\"]) :\n","  if p > 0.5 :\n","    if l!=1:\n","      ##予測ラベルが1でないなら対応するバイトコードを出力\n","      datasets.loc[i].to_csv('./drive/MyDrive/ErrorList06.csv', mode='a')\n","  else :\n","    if l!=0:\n","      ##予測ラベルが0でないなら対応するバイトコードを出力\n","      datasets.loc[i].to_csv('./drive/MyDrive/ErrorList06.csv', mode='a')\n","\n","print(classification_report(pred, test_y[\"label_id\"]))"]}]}