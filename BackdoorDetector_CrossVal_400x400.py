{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"mount_file_id":"1EGaR0knEKyUI3KZ44wsCzfrnO8crXAqG","authorship_tag":"ABX9TyOZSX6rpxxvqC4OnGiOrZXF"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"9e58a22c3f2442e691ee907433f73668":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_6f350a8a09444baca106ab857375b092","IPY_MODEL_efccc6875f7f44b79619c72b095dc8be","IPY_MODEL_8bb175ba290542008f7f7a14de770237"],"layout":"IPY_MODEL_b1e55ef03bd648d4acbce7848e24ce90"}},"6f350a8a09444baca106ab857375b092":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e80ea1d0b28f4820aa1e67c5df87bbe4","placeholder":"​","style":"IPY_MODEL_c4ce754377504d28bcc1c3f6321ab942","value":"100%"}},"efccc6875f7f44b79619c72b095dc8be":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_62706b52661847eabb50286d9c1c738e","max":2313,"min":0,"orientation":"horizontal","style":"IPY_MODEL_58a16c8e07ad4f64af466bfcdfb19a0d","value":2313}},"8bb175ba290542008f7f7a14de770237":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_78da2c7104c340fcb22460e0b31ace3d","placeholder":"​","style":"IPY_MODEL_da6214a6bdb14f4eb755380e44ab97f2","value":" 2313/2313 [00:00&lt;00:00, 2602.64it/s]"}},"b1e55ef03bd648d4acbce7848e24ce90":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e80ea1d0b28f4820aa1e67c5df87bbe4":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c4ce754377504d28bcc1c3f6321ab942":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"62706b52661847eabb50286d9c1c738e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"58a16c8e07ad4f64af466bfcdfb19a0d":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"78da2c7104c340fcb22460e0b31ace3d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"da6214a6bdb14f4eb755380e44ab97f2":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5b3da50c61c84ef5b30a88b703185f57":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_6e9b49aa8f6945169cf31c381f23fecd","IPY_MODEL_bafcd4b8a723471d8976cdb76a5b09e0","IPY_MODEL_29fa7b12e41940c5a6eb9129d1804c45"],"layout":"IPY_MODEL_49c092ec7c50453d9900a0f74fa931dd"}},"6e9b49aa8f6945169cf31c381f23fecd":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_d3c7ad146e024244b77b15e121f90b64","placeholder":"​","style":"IPY_MODEL_28221d8314a54574a2e659bb6c85a4d6","value":""}},"bafcd4b8a723471d8976cdb76a5b09e0":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_97e16f8b3d9c43dd8347d6c2953ffad3","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_a183790a87fb46528a6e989523d8c552","value":1}},"29fa7b12e41940c5a6eb9129d1804c45":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_c3de6a736e4c4349ad5d5d5c0a84b744","placeholder":"​","style":"IPY_MODEL_7ce4b2fc60bc4543b429b503ce550a2c","value":" 2313/? [00:30&lt;00:00, 76.68it/s]"}},"49c092ec7c50453d9900a0f74fa931dd":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d3c7ad146e024244b77b15e121f90b64":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"28221d8314a54574a2e659bb6c85a4d6":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"97e16f8b3d9c43dd8347d6c2953ffad3":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"a183790a87fb46528a6e989523d8c552":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"c3de6a736e4c4349ad5d5d5c0a84b744":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7ce4b2fc60bc4543b429b503ce550a2c":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["9e58a22c3f2442e691ee907433f73668","6f350a8a09444baca106ab857375b092","efccc6875f7f44b79619c72b095dc8be","8bb175ba290542008f7f7a14de770237","b1e55ef03bd648d4acbce7848e24ce90","e80ea1d0b28f4820aa1e67c5df87bbe4","c4ce754377504d28bcc1c3f6321ab942","62706b52661847eabb50286d9c1c738e","58a16c8e07ad4f64af466bfcdfb19a0d","78da2c7104c340fcb22460e0b31ace3d","da6214a6bdb14f4eb755380e44ab97f2","5b3da50c61c84ef5b30a88b703185f57","6e9b49aa8f6945169cf31c381f23fecd","bafcd4b8a723471d8976cdb76a5b09e0","29fa7b12e41940c5a6eb9129d1804c45","49c092ec7c50453d9900a0f74fa931dd","d3c7ad146e024244b77b15e121f90b64","28221d8314a54574a2e659bb6c85a4d6","97e16f8b3d9c43dd8347d6c2953ffad3","a183790a87fb46528a6e989523d8c552","c3de6a736e4c4349ad5d5d5c0a84b744","7ce4b2fc60bc4543b429b503ce550a2c"]},"id":"TgyOb3hCmCNu","executionInfo":{"status":"ok","timestamp":1675585321849,"user_tz":-540,"elapsed":640323,"user":{"displayName":"清水嶺","userId":"11678528705416048401"}},"outputId":"29227213-945e-4f64-8f92-107441310c85"},"outputs":[{"output_type":"stream","name":"stdout","text":["(2313, 400)\n"]},{"output_type":"display_data","data":{"text/plain":["  0%|          | 0/2313 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"9e58a22c3f2442e691ee907433f73668"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["creating word2vec model ...\n"]},{"output_type":"stream","name":"stderr","text":["WARNING:gensim.models.base_any2vec:Effective 'alpha' higher than previous training cycles\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n","2313\n"]},{"output_type":"display_data","data":{"text/plain":["0it [00:00, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"5b3da50c61c84ef5b30a88b703185f57"}},"metadata":{}},{"output_type":"stream","name":"stdout","text":["            X1        X2        X3        X4        X5        X6        X7  \\\n","0     0.591364 -0.623420 -0.789747  0.171668 -0.062471  0.032692 -0.263756   \n","1     0.546923 -0.333292 -1.064339  0.123111 -0.073469  0.111270 -0.270314   \n","2     0.563830 -0.476283 -0.993693  0.064273 -0.107488  0.192213 -0.236940   \n","3     0.563267 -0.484800 -0.987948  0.063015 -0.107063  0.197121 -0.239557   \n","4     0.548126 -0.524453 -0.885059  0.009679 -0.057982  0.159262 -0.280344   \n","...        ...       ...       ...       ...       ...       ...       ...   \n","2308  0.552956 -0.635197 -0.801028  0.143355 -0.056885  0.156079 -0.129838   \n","2309  0.554131 -0.626090 -0.717140  0.170885 -0.030767 -0.019205 -0.274302   \n","2310  0.552128 -0.549286 -0.929498  0.028888 -0.111226  0.115051 -0.237823   \n","2311  0.576609 -0.657826 -0.787288  0.185744 -0.078834  0.134612 -0.144670   \n","2312  0.506788 -0.694305 -0.448635  0.153754  0.025613  0.219417 -0.230683   \n","\n","            X8        X9       X10  ...  tfidf_X390  tfidf_X391  tfidf_X392  \\\n","0    -0.459894  0.556320 -0.271512  ...    0.106496    0.237955    0.092107   \n","1    -0.407024  0.626145 -0.102499  ...    0.058225    0.284653    0.103555   \n","2    -0.421205  0.535905 -0.125522  ...    0.081730    0.294996    0.127759   \n","3    -0.424553  0.535812 -0.125783  ...    0.081073    0.295983    0.124881   \n","4    -0.376232  0.515744 -0.160271  ...    0.068762    0.286322    0.107135   \n","...        ...       ...       ...  ...         ...         ...         ...   \n","2308 -0.589629  0.586528 -0.207730  ...    0.105580    0.238321    0.106940   \n","2309 -0.467692  0.541463 -0.277650  ...    0.092806    0.294560    0.099911   \n","2310 -0.395356  0.506877 -0.190693  ...    0.063268    0.297595    0.129522   \n","2311 -0.584788  0.631854 -0.251326  ...    0.135238    0.250941    0.099217   \n","2312 -0.438106  0.461671  0.018303  ...    0.024662    0.120570    0.001371   \n","\n","      tfidf_X393  tfidf_X394  tfidf_X395  tfidf_X396  tfidf_X397  tfidf_X398  \\\n","0       0.035758    0.018615    0.018051    0.011089    0.009057    0.003508   \n","1       0.030217    0.008656    0.000000    0.000000    0.000000    0.000000   \n","2       0.060073    0.005126    0.000000    0.002378    0.000000    0.000000   \n","3       0.060536    0.005165    0.000000    0.002396    0.000000    0.000000   \n","4       0.044001    0.002262    0.000000    0.000000    0.000000    0.000000   \n","...          ...         ...         ...         ...         ...         ...   \n","2308    0.027624    0.014947    0.017666    0.008158    0.008663    0.009394   \n","2309    0.048463    0.030368    0.053623    0.018786    0.016623    0.012360   \n","2310    0.025798    0.006466    0.001074    0.000000    0.000000    0.000000   \n","2311    0.036095    0.024126    0.030298    0.005597    0.000000    0.000000   \n","2312    0.000000    0.000000    0.000000    0.000000    0.000000    0.000000   \n","\n","      tfidf_X399  \n","0       0.004954  \n","1       0.005831  \n","2       0.000000  \n","3       0.000000  \n","4       0.000000  \n","...          ...  \n","2308    0.011846  \n","2309    0.000000  \n","2310    0.000000  \n","2311    0.000000  \n","2312    0.022230  \n","\n","[2313 rows x 800 columns]\n","      label_id\n","0            0\n","1            0\n","2            0\n","3            0\n","4            0\n","...        ...\n","2308         1\n","2309         1\n","2310         1\n","2311         1\n","2312         1\n","\n","[2313 rows x 1 columns]\n","Fitting XGboost model ...\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["Done.\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:98: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n","/usr/local/lib/python3.8/dist-packages/sklearn/preprocessing/_label.py:133: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().\n","  y = column_or_1d(y, warn=True)\n"]},{"output_type":"stream","name":"stdout","text":["accuracy: 0.9783792880985105\n","precision: 0.9868697495868805\n","recall: 0.9896392896781354\n","f1_macro: 0.9265902669658193\n","neg_log loss: -0.055095200139468295\n"]}],"source":["import pandas as pd\n","import numpy as np\n","import xgboost as xgb\n","import logging\n","from tqdm.notebook import tqdm\n","from gensim.models import Word2Vec\n","from sklearn.feature_extraction.text import TfidfVectorizer\n","from sklearn.model_selection import train_test_split\n","from sklearn.model_selection import StratifiedKFold\n","from sklearn.model_selection import cross_validate\n","from sklearn.metrics import classification_report\n","datasets = pd.read_csv(\"./drive/MyDrive/evmbytecodes.csv\", names=(\"label\", \"evmcode\")) #データセット読み込み\n","\n","# word2vec parameters\n","num_features    = 400\n","min_word_count  = 5\n","num_workers     = 40\n","context         = 10\n","downsampling    = 1e-3\n","model_name = \"evmcode_feature200.model\"\n","\n","# コーパス読み込み\n","corpus = []\n","tfidf_X = []\n","\n","# TF_IDFによる文書ベクトルの生成\n","vectorizer = TfidfVectorizer(max_features = num_features)\n","tfidf_X = vectorizer.fit_transform(datasets[\"evmcode\"])\n","print(tfidf_X.shape)\n","tfidf_data_X = pd.DataFrame(tfidf_X.toarray(),columns=[\"tfidf_X\"+str(i) for i in range(tfidf_X.shape[1])])\n","for doc in tqdm(datasets[\"evmcode\"]):\n","    corpus.append(doc.split(\" \"))\n","\n","# word2vecモデルの作成＆モデルの保存\n","print(\"creating word2vec model ...\")\n","logging.basicConfig(format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)\n","model = Word2Vec(corpus,size = num_features,alpha=0.025,window=5,min_count=5,workers=4,min_alpha=0.001)\n","model.train(corpus,total_examples=len(corpus),epochs=50)\n","model.save(model_name)\n","print(\"Done.\")\n","\n","# word2vecによる文書ベクトルの生成\n","def wordvec2docvec(sentence,model):\n","    # 文章ベクトルの初期値（0ベクトルを初期値とする）\n","    docvecs = np.zeros(num_features, dtype=\"float32\")\n","    # 文章に現れる単語のうち、モデルに存在しない単語をカウントする\n","    denomenator = len(sentence)\n","    # 文章内の各単語ベクトルを足し合わせる\n","    for word in sentence:\n","        try:\n","            temp = model.wv[word]\n","        except:\n","            denomenator -= 1\n","            continue\n","        docvecs += temp\n","    # 文章に現れる単語のうち、モデルに存在した単語の数で割る\n","    if denomenator > 0:\n","        docvecs =  docvecs / denomenator\n","    return docvecs\n","\n","print(len(datasets[\"evmcode\"]))\n","X, Y = [], []\n","for lb, code in tqdm(zip(datasets[\"label\"], datasets[\"evmcode\"])):\n","    docvec = wordvec2docvec(code.split(\" \"),model)\n","    X.append(list(docvec))\n","    Y.append(lb)\n","\n","# データフレームの構築\n","data_X = pd.DataFrame(X, columns=[\"X\" + str(i + 1) for i in range(num_features)])\n","data_Y = pd.DataFrame(Y, columns=[\"label_id\"])\n","data_TFIDF_W2V = pd.concat([data_X,tfidf_data_X],axis=1)\n","print(data_TFIDF_W2V)\n","print(data_Y)\n","\n","# テストデータの分割（層化5分割）\n","skf = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n","\n","# 評価指標\n","score_funcs = [\n","    'accuracy',\n","    'precision',\n","    'recall',\n","    'f1_macro',\n","    'neg_log_loss'\n","]\n","\n","# XGboostモデルの学習\n","print(\"Fitting XGboost model ...\")\n","xgb_model = xgb.XGBClassifier()\n","xgb_model.fit(data_TFIDF_W2V, data_Y)\n","print(\"Done.\")\n","\n","# 交差検証\n","scores = cross_validate(xgb_model, data_TFIDF_W2V, data_Y, cv=skf, scoring=score_funcs)\n","print('accuracy:', scores['test_accuracy'].mean())\n","print('precision:', scores['test_precision'].mean())\n","print('recall:', scores['test_recall'].mean())\n","print('f1_macro:', scores['test_f1_macro'].mean())\n","print('neg_log loss:', scores['test_neg_log_loss'].mean())"]}]}